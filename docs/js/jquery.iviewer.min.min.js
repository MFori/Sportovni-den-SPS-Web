(function(c,r){function l(a){var b=a.originalEvent.changedTouches[0];return c.extend(a,{type:t[a.type],which:1,pageX:b.pageX,pageY:b.pageY,screenX:b.screenX,screenY:b.screenY,clientX:b.clientX,clientY:b.clientY,isTouchEvent:!0})}var t={touchstart:"mousedown",touchmove:"mousemove",touchend:"mouseup"},m="ongesturestart"in document.createElement("div"),u=c.ui.mouse.prototype._mouseInit;c.ui.mouse.prototype._mouseInit=function(){var a=this;a._touchActive=!1;this.element.bind("touchstart."+this.widgetName,
function(b){if(!(m&&1<b.originalEvent.touches.length))return a._touchActive=!0,a._mouseDown(l(b))});a=this;this._mouseMoveDelegate=function(b){if(!(m&&b.originalEvent.touches&&1<b.originalEvent.touches.length)&&a._touchActive)return a._mouseMove(l(b))};this._mouseUpDelegate=function(b){if(a._touchActive)return a._touchActive=!1,a._mouseUp(l(b))};c(document).bind("touchmove."+this.widgetName,this._mouseMoveDelegate).bind("touchend."+this.widgetName,this._mouseUpDelegate);u.apply(this)};var k=function(a,
b){return function(d){if(0===arguments.length)return b.apply(this);a.apply(this,arguments)}},n={0:{marginLeft:0,marginTop:0,filter:'progid:DXImageTransform.Microsoft.Matrix(M11=1, M12=0, M21=0, M22=1, SizingMethod="auto expand")'},90:{marginLeft:-1,marginTop:1,filter:'progid:DXImageTransform.Microsoft.Matrix(M11=0, M12=-1, M21=1, M22=0, SizingMethod="auto expand")'},180:{marginLeft:0,marginTop:0,filter:'progid:DXImageTransform.Microsoft.Matrix(M11=-1, M12=0, M21=0, M22=-1, SizingMethod="auto expand")'},
270:{marginLeft:-1,marginTop:1,filter:'progid:DXImageTransform.Microsoft.Matrix(M11=0, M12=1, M21=-1, M22=0, SizingMethod="auto expand")'}},q=function(){var a=document.createElement("div");a.style.cssText=["-ms-","",""].join("filter:blur(2px); ");return!!a.style.cssText&&9>document.documentMode}();c.widget("ui.iviewer",c.ui.mouse,{widgetEventPrefix:"iviewer",options:{zoom:"fit",zoom_base:100,zoom_max:800,zoom_min:25,zoom_delta:1.4,zoom_animation:!0,ui_disabled:!1,mousewheel:!0,update_on_resize:!0,
onZoom:jQuery.noop,onAfterZoom:jQuery.noop,onStartDrag:jQuery.noop,onDrag:jQuery.noop,onStopDrag:jQuery.noop,onMouseMove:jQuery.noop,onClick:jQuery.noop,onStartLoad:null,onFinishLoad:null,onErrorLoad:null},_create:function(){var a=this;this.dy=this.dx=0;this.img_object={};this.zoom_object={};this._angle=0;this.current_zoom=this.options.zoom;if(null!==this.options.src){this.container=this.element;this._updateContainerInfo();this.container.css("overflow","hidden");1==this.options.update_on_resize&&
c(window).resize(function(){a.update()});this.img_object=new c.ui.iviewer.ImageObject(this.options.zoom_animation);if(this.options.mousewheel&&(this.container.bind("mousewheel.iviewer",function(b,d){var e=0<d?1:-1,c=a.container.offset();a.zoom_by(e,{x:b.pageX-c.left,y:b.pageY-c.top});return!1}),m)){var b=+new Date,d,e;this.img_object.object().bind("touchstart",function(b){d=a.current_zoom;b=b.originalEvent.touches;var c;2==b.length?(c=a.container.offset(),e={x:(b[0].pageX+b[1].pageX)/2-c.left,y:(b[0].pageY+
b[1].pageY)/2-c.top}):e=null}).bind("gesturechange",function(c){var f=+new Date;50>f-b||(b=f,a.set_zoom(d*c.originalEvent.scale,e),c.preventDefault())}).bind("gestureend",function(a){e=null})}this.img_object.object().click(function(b){return a._click(b)}).prependTo(this.container);this.container.bind("mousemove",function(b){a._handleMouseMove(b)});this.loadImage(this.options.src);this.options.ui_disabled||this.createui();this._mouseInit()}},destroy:function(){c.Widget.prototype.destroy.call(this);
this._mouseDestroy();this.img_object.object().remove();this.container.off(".iviewer");this.container.css("overflow","")},_updateContainerInfo:function(){this.options.height=this.container.height();this.options.width=this.container.width()},update:function(){this._updateContainerInfo();this.setCoords(this.img_object.x(),this.img_object.y())},loadImage:function(a){this.current_zoom=this.options.zoom;var b=this;this._trigger("onStartLoad",0,a);this.container.addClass("iviewer_loading");this.img_object.load(a,
function(){b._imageLoaded(a)},function(){b._trigger("onErrorLoad",0,a)})},_imageLoaded:function(a){this.container.removeClass("iviewer_loading");this.container.addClass("iviewer_cursor");"fit"==this.options.zoom?this.fit(!0):this.set_zoom(this.options.zoom,!0);this._trigger("onFinishLoad",0,a)},fit:function(a){var b=0,b=this.img_object.orig_width()/this.img_object.orig_height()>this.options.width/this.options.height?this.options.width/this.img_object.orig_width()*100:this.options.height/this.img_object.orig_height()*
100;this.set_zoom(b,a)},center:function(){this.setCoords(-Math.round((this.img_object.display_width()-this.options.width)/2),-Math.round((this.img_object.display_height()-this.options.height)/2))},moveTo:function(a,b){var d=a-Math.round(this.options.width/2),e=b-Math.round(this.options.height/2),d=this.img_object.x()-d,e=this.img_object.y()-e;this.setCoords(d,e)},getContainerOffset:function(){return jQuery.extend({},this.container.offset())},setCoords:function(a,b){if(this.img_object.loaded()){var d=
this._correctCoords(a,b);this.img_object.x(d.x);this.img_object.y(d.y)}},_correctCoords:function(a,b){a=parseInt(a,10);b=parseInt(b,10);0<b&&(b=0);0<a&&(a=0);b+this.img_object.display_height()<this.options.height&&(b=this.options.height-this.img_object.display_height());a+this.img_object.display_width()<this.options.width&&(a=this.options.width-this.img_object.display_width());this.img_object.display_width()<=this.options.width&&(a=-(this.img_object.display_width()-this.options.width)/2);this.img_object.display_height()<=
this.options.height&&(b=-(this.img_object.display_height()-this.options.height)/2);return{x:a,y:b}},containerToImage:function(a,b){var d={x:a-this.img_object.x(),y:b-this.img_object.y()},d=this.img_object.toOriginalCoords(d);return{x:h.descaleValue(d.x,this.current_zoom),y:h.descaleValue(d.y,this.current_zoom)}},imageToContainer:function(a,b){var d={x:h.scaleValue(a,this.current_zoom),y:h.scaleValue(b,this.current_zoom)};return this.img_object.toRealCoords(d)},_getMouseCoords:function(a){var b=this.container.offset();
return coords=this.containerToImage(a.pageX-b.left,a.pageY-b.top)},set_zoom:function(a,b,d){if(0!=this._trigger("onZoom",0,a)&&this.img_object.loaded()){d=d||{x:Math.round(this.options.width/2),y:Math.round(this.options.height/2)};a<this.options.zoom_min?a=this.options.zoom_min:a>this.options.zoom_max&&(a=this.options.zoom_max);if("fit"==this.current_zoom){var e=d.x+Math.round(this.img_object.orig_width()/2),c=d.y+Math.round(this.img_object.orig_height()/2);this.current_zoom=100}else e=-this.img_object.x()+
d.x,c=-this.img_object.y()+d.y;var f=h.scaleValue(this.img_object.orig_width(),a),g=h.scaleValue(this.img_object.orig_height(),a),e=h.scaleValue(h.descaleValue(e,this.current_zoom),a),c=h.scaleValue(h.descaleValue(c,this.current_zoom),a),e=d.x-e,c=d.y-c,f=Math.floor(f),g=Math.floor(g),e=Math.floor(e),c=Math.floor(c);this.img_object.display_width(f);this.img_object.display_height(g);d=this._correctCoords(e,c);var v=this;this.img_object.setImageProps(f,g,d.x,d.y,b,function(){v._trigger("onAfterZoom",
0,a)});this.current_zoom=a;this.update_status()}},zoom_by:function(a,b){var d=this.find_closest_zoom_rate(this.current_zoom)+a,d=this.options.zoom_base*Math.pow(this.options.zoom_delta,d);0<a&&d<this.current_zoom&&(d*=this.options.zoom_delta);0>a&&d>this.current_zoom&&(d/=this.options.zoom_delta);this.set_zoom(d,r,b)},angle:function(a,b){if(0===arguments.length)return this.img_object.angle();-270>a||270<a||0!==a%90||(b||(a+=this.img_object.angle()),0>a&&(a+=360),360<=a&&(a-=360),a!==this.img_object.angle()&&
(this.img_object.angle(a),this.center(),this._trigger("angle",0,{angle:this.img_object.angle()})))},find_closest_zoom_rate:function(a){function b(a,b){return a/b}function d(a,b){return a*b}if(a==this.options.zoom_base)return 0;for(var c=a>this.options.zoom_base?d:b,p=a>this.options.zoom_base?1:-1,f=this.options.zoom_delta,g=1;Math.abs(c(this.options.zoom_base,Math.pow(f,g))-a)>Math.abs(c(this.options.zoom_base,Math.pow(f,g+1))-a);)g++;return p*g},update_status:function(){if(!this.options.ui_disabled){var a=
Math.round(100*this.img_object.display_height()/this.img_object.orig_height());a&&this.zoom_object.html(a+"%")}},info:function(a,b){if(a)switch(a){case "orig_width":case "orig_height":return b?0===this.img_object.angle()%180?this.img_object[a]():"orig_width"===a?this.img_object.orig_height():this.img_object.orig_width():this.img_object[a]();case "display_width":case "display_height":case "angle":return this.img_object[a]();case "zoom":return this.current_zoom;case "src":return this.img_object.object().attr("src");
case "coords":return{x:this.img_object.x(),y:this.img_object.y()}}},_mouseStart:function(a){c.ui.mouse.prototype._mouseStart.call(this,a);if(!1===this._trigger("onStartDrag",0,this._getMouseCoords(a)))return!1;this.container.addClass("iviewer_drag_cursor");this._dragInitialized=!(a.originalEvent.changedTouches&&1==a.originalEvent.changedTouches.length);this.dx=a.pageX-this.img_object.x();this.dy=a.pageY-this.img_object.y();return!0},_mouseCapture:function(a){return!0},_handleMouseMove:function(a){this._trigger("onMouseMove",
a,this._getMouseCoords(a))},_mouseDrag:function(a){c.ui.mouse.prototype._mouseDrag.call(this,a);this._dragInitialized||(this.dx=a.pageX-this.img_object.x(),this.dy=a.pageY-this.img_object.y(),this._dragInitialized=!0);this.setCoords(a.pageX-this.dx,a.pageY-this.dy);this._trigger("onDrag",a,this._getMouseCoords(a));return!1},_mouseStop:function(a){c.ui.mouse.prototype._mouseStop.call(this,a);this.container.removeClass("iviewer_drag_cursor");this._trigger("onStopDrag",0,this._getMouseCoords(a))},_click:function(a){this._trigger("onClick",
0,this._getMouseCoords(a))},createui:function(){var a=this;c("<div>",{"class":"iviewer_zoom_in iviewer_common iviewer_button"}).bind("mousedown touchstart",function(){a.zoom_by(1);return!1}).appendTo(this.container);c("<div>",{"class":"iviewer_zoom_out iviewer_common iviewer_button"}).bind("mousedown touchstart",function(){a.zoom_by(-1);return!1}).appendTo(this.container);c("<div>",{"class":"iviewer_zoom_zero iviewer_common iviewer_button"}).bind("mousedown touchstart",function(){a.set_zoom(100);
return!1}).appendTo(this.container);c("<div>",{"class":"iviewer_zoom_fit iviewer_common iviewer_button"}).bind("mousedown touchstart",function(){a.fit(this);return!1}).appendTo(this.container);this.zoom_object=c("<div>").addClass("iviewer_zoom_status iviewer_common").appendTo(this.container);c("<div>",{"class":"iviewer_rotate_left iviewer_common iviewer_button"}).bind("mousedown touchstart",function(){a.angle(-90);return!1}).appendTo(this.container);c("<div>",{"class":"iviewer_rotate_right iviewer_common iviewer_button"}).bind("mousedown touchstart",
function(){a.angle(90);return!1}).appendTo(this.container);this.update_status()}});c.ui.iviewer.ImageObject=function(a){this._img=c("<img>").css({position:"absolute",top:"0px",left:"0px"});this._swapDimensions=this._loaded=!1;this._do_anim=a||!1;this.x(0,!0);this.y(0,!0);this.angle(0)};(function(){this._reset=function(a,b){this._angle=0;this._swapDimensions=!1;this.x(0);this.y(0);this.orig_width(a);this.orig_height(b);this.display_width(a);this.display_height(b)};this.loaded=function(){return this._loaded};
this.load=function(a,b,d){var c=this;b=b||jQuery.noop;this._loaded=!1;var p=new Image;p.onload=function(){c._loaded=!0;c._reset(this.width,this.height);c._img.removeAttr("width").removeAttr("height").removeAttr("style").css({position:"absolute",top:"0px",left:"0px",maxWidth:"none"});c._img[0].src=a;b()};p.onerror=d;setTimeout(function(){p.src=a},0);this.angle(0)};this._dimension=function(a,b){var d="_"+a+"_"+b,c="_"+a+"_"+("height"===b?"width":"height");return k(function(a){this[this._swapDimensions?
d:c]=a},function(){return this[this._swapDimensions?d:c]})};this.display_width=this._dimension("display","width");this.display_height=this._dimension("display","height");this.display_diff=function(){return Math.floor(this.display_width()-this.display_height())};this.orig_width=this._dimension("orig","width");this.orig_height=this._dimension("orig","height");this.x=k(function(a,b){this._x=a;b||(this._finishAnimation(),this._img.css("left",this._x+(this._swapDimensions?this.display_diff()/2:0)+"px"))},
function(){return this._x});this.y=k(function(a,b){this._y=a;b||(this._finishAnimation(),this._img.css("top",this._y-(this._swapDimensions?this.display_diff()/2:0)+"px"))},function(){return this._y});this.angle=k(function(a){var b=this._swapDimensions;this._angle=a;this._swapDimensions=0!==a%180;b!==this._swapDimensions&&(b=this._swapDimensions?-1:1,this.x(this.x()-b*this.display_diff()/2,!0),this.y(this.y()+b*this.display_diff()/2,!0));var d="rotate("+a+"deg)",c=this._img;jQuery.each(["","-webkit-",
"-moz-","-o-","-ms-"],function(a,b){c.css(b+"transform",d)});q&&(jQuery.each(["-ms-",""],function(b,d){c.css(d+"filter",n[a].filter)}),c.css({marginLeft:n[a].marginLeft*this.display_diff()/2,marginTop:n[a].marginTop*this.display_diff()/2}))},function(){return this._angle});this.toOriginalCoords=function(a){switch(this.angle()){case 0:return{x:a.x,y:a.y};case 90:return{x:a.y,y:this.display_width()-a.x};case 180:return{x:this.display_width()-a.x,y:this.display_height()-a.y};case 270:return{x:this.display_height()-
a.y,y:a.x}}};this.toRealCoords=function(a){switch(this.angle()){case 0:return{x:this.x()+a.x,y:this.y()+a.y};case 90:return{x:this.x()+this.display_width()-a.y,y:this.y()+a.x};case 180:return{x:this.x()+this.display_width()-a.x,y:this.y()+this.display_height()-a.y};case 270:return{x:this.x()+a.y,y:this.y()+this.display_height()-a.x}}};this.object=k(jQuery.noop,function(){return this._img});this.setImageProps=function(a,b,c,e,h,f){f=f||jQuery.noop;this.display_width(a);this.display_height(b);this.x(c,
!0);this.y(e,!0);a={width:this._swapDimensions?b:a,height:this._swapDimensions?a:b,top:e-(this._swapDimensions?this.display_diff()/2:0)+"px",left:c+(this._swapDimensions?this.display_diff()/2:0)+"px"};q&&jQuery.extend(a,{marginLeft:n[this.angle()].marginLeft*this.display_diff()/2,marginTop:n[this.angle()].marginTop*this.display_diff()/2});var g=this._swapDimensions,k=this._img;if(q&&g){var l=this._img.width(),m=this._img.height(),r=a.height-l;iedw=a.width-m;delete a.width;delete a.height}this._do_anim&&
!h?this._img.stop(!0).animate(a,{duration:200,complete:f,step:function(a,b){if(q&&g&&"top"===b.prop){var c=(a-b.start)/(b.end-b.start);k.height(l+r*c);k.width(m+iedw*c);k.css("top",a)}}}):(this._img.css(a),setTimeout(f,0))};this._finishAnimation=function(){this._img.stop(!0,!0)}}).apply(c.ui.iviewer.ImageObject.prototype);var h={scaleValue:function(a,b){return a*b/100},descaleValue:function(a,b){return 100*a/b}}})(jQuery,void 0);
