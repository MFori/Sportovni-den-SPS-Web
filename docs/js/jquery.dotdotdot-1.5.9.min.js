(function(h){function y(a,b,m,d,g){var k=a.contents(),c=!1;a.empty();for(var e=0,p=k.length;e<p&&!c;e++){var q=k[e],f=h(q);if("undefined"!=typeof q){a.append(f);if(g)a[a.is("table, thead, tbody, tfoot, tr, col, colgroup, object, embed, param, ol, ul, dl, select, optgroup, option, textarea, script, style")?"after":"append"](g);3==q.nodeType?v(m,d)&&(c=z(f,b,m,d,g)):c=y(f,b,m,d,g);c||g&&g.remove()}}return c}function z(a,b,h,d,g){var k=!1,c=a[0];if("undefined"==typeof c)return!1;for(var e="letter"==
d.wrap?"":" ",p=A(c).split(e),q=-1,f=-1,x=0,l=p.length-1;x<=l;){var n=Math.floor((x+l)/2);if(n==f)break;f=n;u(c,p.slice(0,f+1).join(e)+d.ellipsis);v(h,d)?l=f:x=q=f}-1==q||1==p.length&&0==p[0].length?(e=a.parent(),a.remove(),c=g?g.length:0,e.contents().size()>c?(k=e.contents().eq(-1-c),k=z(k,b,h,d,g)):(b=e.prev(),c=b.contents().eq(-1)[0],"undefined"!=typeof c&&(d=B(A(c),d),u(c,d),g&&b.append(g),e.remove(),k=!0))):(d=B(p.slice(0,q+1).join(e),d),k=!0,u(c,d));return k}function v(a,b){return a.innerHeight()>
b.maxHeight}function B(a,b){for(;-1<h.inArray(a.slice(-1),b.lastCharacter.remove);)a=a.slice(0,-1);0>h.inArray(a.slice(-1),b.lastCharacter.noEllipsis)&&(a+=b.ellipsis);return a}function t(a){return{width:a.innerWidth(),height:a.innerHeight()}}function u(a,b){a.innerText?a.innerText=b:a.nodeValue?a.nodeValue=b:a.textContent&&(a.textContent=b)}function A(a){return a.innerText?a.innerText:a.nodeValue?a.nodeValue:a.textContent?a.textContent:""}function E(a,b){return"undefined"!=typeof a&&a?"string"==
typeof a?(a=h(a,b),a.length?a:!1):"object"==typeof a?"undefined"==typeof a.jquery?!1:a:!1:!1}function F(a,b){if(!a)return!1;b="string"==typeof b?"dotdotdot: "+b:["dotdotdot:",b];"undefined"!=typeof window.console&&"undefined"!=typeof window.console.log&&window.console.log(b);return!1}if(!h.fn.dotdotdot){h.fn.dotdotdot=function(a){if(0==this.length)return a&&!1===a.debug||F(!0,'No element found for "'+this.selector+'".'),this;if(1<this.length)return this.each(function(){h(this).dotdotdot(a)});var b=
this;b.data("dotdotdot")&&b.trigger("destroy.dot");b.data("dotdotdot-style",b.attr("style"));b.css("word-wrap","break-word");b.bind_events=function(){b.bind("update.dot",function(a,c){a.preventDefault();a.stopPropagation();var f=d,k;if("number"==typeof d.height)k=d.height;else{k=b.innerHeight();for(var l=["paddingTop","paddingBottom"],n=0,w=l.length;n<w;n++){var r=parseInt(b.css(l[n]),10);isNaN(r)&&(r=0);k-=r}}f.maxHeight=k;d.maxHeight+=d.tolerance;if("undefined"!=typeof c){if("string"==typeof c||
c instanceof HTMLElement)c=h("<div />").append(c).contents();c instanceof h&&(m=c)}e=b.wrapInner('<div class="dotdotdot" />').children();e.empty().append(m.clone(!0)).css({height:"auto",width:"auto",border:"none",padding:0,margin:0});f=l=!1;g.afterElement&&(l=g.afterElement.clone(!0),g.afterElement.remove());if(v(e,d))if("children"==d.wrap){f=e;k=d;n=f.children();w=!1;f.empty();for(var r=0,u=n.length;r<u;r++){var t=n.eq(r);f.append(t);l&&f.append(l);if(v(f,k)){t.remove();w=!0;break}else l&&l.remove()}f=
w}else f=y(e,b,e,d,l);e.replaceWith(e.contents());e=null;h.isFunction(d.callback)&&d.callback.call(b[0],f,m);return g.isTruncated=f}).bind("isTruncated.dot",function(a,c){a.preventDefault();a.stopPropagation();"function"==typeof c&&c.call(b[0],g.isTruncated);return g.isTruncated}).bind("originalContent.dot",function(a,c){a.preventDefault();a.stopPropagation();"function"==typeof c&&c.call(b[0],m);return m}).bind("destroy.dot",function(a){a.preventDefault();a.stopPropagation();b.unwatch().unbind_events().empty().append(m).attr("style",
b.data("dotdotdot-style")).data("dotdotdot",!1)});return b};b.unbind_events=function(){b.unbind(".dot");return b};b.watch=function(){b.unwatch();if("window"==d.watch){var a=h(window),e=a.width(),f=a.height();a.bind("resize.dot"+g.dotId,function(){e==a.width()&&f==a.height()&&d.windowResizeFix||(e=a.width(),f=a.height(),c&&clearInterval(c),c=setTimeout(function(){b.trigger("update.dot")},10))})}else k=t(b),c=setInterval(function(){var a=t(b);if(k.width!=a.width||k.height!=a.height)b.trigger("update.dot"),
k=t(b)},100);return b};b.unwatch=function(){h(window).unbind("resize.dot"+g.dotId);c&&clearInterval(c);return b};var m=b.contents(),d=h.extend(!0,{},h.fn.dotdotdot.defaults,a),g={},k={},c=null,e=null;g.afterElement=E(d.after,b);g.isTruncated=!1;g.dotId=G++;b.data("dotdotdot",!0).bind_events().trigger("update.dot");d.watch&&b.watch();return b};h.fn.dotdotdot.defaults={ellipsis:"... ",wrap:"word",lastCharacter:{remove:" ,;.!?".split(""),noEllipsis:[]},tolerance:0,callback:null,after:null,height:null,
watch:!1,windowResizeFix:!0,debug:!1};var G=1,C=h.fn.html;h.fn.html=function(a){return"undefined"!=typeof a?this.data("dotdotdot")&&"function"!=typeof a?this.trigger("update",[a]):C.call(this,a):C.call(this)};var D=h.fn.text;h.fn.text=function(a){if("undefined"!=typeof a){if(this.data("dotdotdot")){var b=h("<div />");b.text(a);a=b.html();b.remove();return this.trigger("update",[a])}return D.call(this,a)}return D.call(this)}}})(jQuery);
