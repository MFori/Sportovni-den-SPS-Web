(function(h){function y(a,b,m,d,g){var k=a.contents(),c=!1;a.empty();for(var f=0,p=k.length;p>f&&!c;f++){var q=k[f],e=h(q);void 0!==q&&(a.append(e),g&&a[a.is("table, thead, tbody, tfoot, tr, col, colgroup, object, embed, param, ol, ul, dl, select, optgroup, option, textarea, script, style")?"after":"append"](g),3==q.nodeType?v(m,d)&&(c=z(e,b,m,d,g)):c=y(e,b,m,d,g),c||g&&g.remove())}return c}function z(a,b,h,d,g){var k=!1,c=a[0];if(void 0===c)return!1;for(var f="letter"==d.wrap?"":" ",p=A(c).split(f),
q=-1,e=-1,x=0,l=p.length-1;l>=x;){var n=Math.floor((x+l)/2);if(n==e)break;e=n;u(c,p.slice(0,e+1).join(f)+d.ellipsis);v(h,d)?l=e:(q=e,x=e)}-1==q||1==p.length&&0==p[0].length?(f=a.parent(),a.remove(),c=g?g.length:0,f.contents().size()>c?(k=f.contents().eq(-1-c),k=z(k,b,h,d,g)):(b=f.prev(),c=b.contents().eq(-1)[0],void 0!==c&&(d=B(A(c),d),u(c,d),g&&b.append(g),f.remove(),k=!0))):(d=B(p.slice(0,q+1).join(f),d),k=!0,u(c,d));return k}function v(a,b){return a.innerHeight()>b.maxHeight}function B(a,b){for(;-1<
h.inArray(a.slice(-1),b.lastCharacter.remove);)a=a.slice(0,-1);return 0>h.inArray(a.slice(-1),b.lastCharacter.noEllipsis)&&(a+=b.ellipsis),a}function t(a){return{width:a.innerWidth(),height:a.innerHeight()}}function u(a,b){a.innerText?a.innerText=b:a.nodeValue?a.nodeValue=b:a.textContent&&(a.textContent=b)}function A(a){return a.innerText?a.innerText:a.nodeValue?a.nodeValue:a.textContent?a.textContent:""}function E(a,b){return void 0===a?!1:a?"string"==typeof a?(a=h(a,b),a.length?a:!1):"object"==
typeof a?void 0===a.jquery?!1:a:!1:!1}function F(a,b){return a?(b="string"==typeof b?"dotdotdot: "+b:["dotdotdot:",b],void 0!==window.console&&void 0!==window.console.log&&window.console.log(b),!1):!1}if(!h.fn.dotdotdot){h.fn.dotdotdot=function(a){if(0==this.length)return a&&!1===a.debug||F(!0,'No element found for "'+this.selector+'".'),this;if(1<this.length)return this.each(function(){h(this).dotdotdot(a)});var b=this;b.data("dotdotdot")&&b.trigger("destroy.dot");b.data("dotdotdot-style",b.attr("style"));
b.css("word-wrap","break-word");b.bind_events=function(){return b.bind("update.dot",function(a,c){a.preventDefault();a.stopPropagation();var e=d,k;if("number"==typeof d.height)k=d.height;else{k=b.innerHeight();for(var l=["paddingTop","paddingBottom"],n=0,w=l.length;w>n;n++){var r=parseInt(b.css(l[n]),10);isNaN(r)&&(r=0);k-=r}}e.maxHeight=k;d.maxHeight+=d.tolerance;void 0!==c&&(("string"==typeof c||c instanceof HTMLElement)&&(c=h("<div />").append(c).contents()),c instanceof h&&(m=c));f=b.wrapInner('<div class="dotdotdot" />').children();
f.empty().append(m.clone(!0)).css({height:"auto",width:"auto",border:"none",padding:0,margin:0});e=l=!1;g.afterElement&&(l=g.afterElement.clone(!0),g.afterElement.remove());if(v(f,d))if("children"==d.wrap){e=f;k=d;n=e.children();w=!1;e.empty();for(var r=0,u=n.length;u>r;r++){var t=n.eq(r);if(e.append(t),l&&e.append(l),v(e,k)){t.remove();w=!0;break}l&&l.remove()}e=w}else e=y(f,b,f,d,l);return f.replaceWith(f.contents()),f=null,h.isFunction(d.callback)&&d.callback.call(b[0],e,m),g.isTruncated=e,e}).bind("isTruncated.dot",
function(a,c){return a.preventDefault(),a.stopPropagation(),"function"==typeof c&&c.call(b[0],g.isTruncated),g.isTruncated}).bind("originalContent.dot",function(a,c){return a.preventDefault(),a.stopPropagation(),"function"==typeof c&&c.call(b[0],m),m}).bind("destroy.dot",function(a){a.preventDefault();a.stopPropagation();b.unwatch().unbind_events().empty().append(m).attr("style",b.data("dotdotdot-style")).data("dotdotdot",!1)}),b};b.unbind_events=function(){return b.unbind(".dot"),b};b.watch=function(){if(b.unwatch(),
"window"==d.watch){var a=h(window),f=a.width(),e=a.height();a.bind("resize.dot"+g.dotId,function(){f==a.width()&&e==a.height()&&d.windowResizeFix||(f=a.width(),e=a.height(),c&&clearInterval(c),c=setTimeout(function(){b.trigger("update.dot")},10))})}else k=t(b),c=setInterval(function(){var a=t(b);(k.width!=a.width||k.height!=a.height)&&(b.trigger("update.dot"),k=t(b))},100);return b};b.unwatch=function(){return h(window).unbind("resize.dot"+g.dotId),c&&clearInterval(c),b};var m=b.contents(),d=h.extend(!0,
{},h.fn.dotdotdot.defaults,a),g={},k={},c=null,f=null;return g.afterElement=E(d.after,b),g.isTruncated=!1,g.dotId=G++,b.data("dotdotdot",!0).bind_events().trigger("update.dot"),d.watch&&b.watch(),b};h.fn.dotdotdot.defaults={ellipsis:"... ",wrap:"word",lastCharacter:{remove:" ,;.!?".split(""),noEllipsis:[]},tolerance:0,callback:null,after:null,height:null,watch:!1,windowResizeFix:!0,debug:!1};var G=1,C=h.fn.html;h.fn.html=function(a){return void 0!==a?this.data("dotdotdot")&&"function"!=typeof a?this.trigger("update",
[a]):C.call(this,a):C.call(this)};var D=h.fn.text;h.fn.text=function(a){if(void 0!==a){if(this.data("dotdotdot")){var b=h("<div />");return b.text(a),a=b.html(),b.remove(),this.trigger("update",[a])}return D.call(this,a)}return D.call(this)}}})(jQuery);
